<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Garden Discovery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: Arial; 
            overflow: hidden; 
            background: black;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
        
        .minimal-instructions {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 12px 20px;
            border-radius: 20px;
            text-align: center;
            font-size: 13px;
            max-width: 70%;
            backdrop-filter: blur(10px);
        }
        
        /* Invisible directional zones for compact movement */
        .discovery-zone {
            position: absolute;
            pointer-events: all;
            background: transparent;
            border: none;
            opacity: 0;
        }
        
        .zone-east {
            right: 10%;
            top: 30%;
            width: 25%;
            height: 40%;
        }
        
        .zone-west {
            left: 10%;
            top: 30%;
            width: 25%;
            height: 40%;
        }
        
        .zone-north {
            top: 15%;
            left: 30%;
            width: 40%;
            height: 25%;
        }
        
        .zone-south {
            bottom: 15%;
            left: 30%;
            width: 40%;
            height: 25%;
        }
        
        .progress-counter {
            position: absolute;
            top: 80px;
            right: 25px;
            background: rgba(255,255,255,0.8);
            padding: 8px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 12px;
            backdrop-filter: blur(5px);
        }
        
        /* Enhanced discovery pulse */
        .discovery-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 3px solid rgba(255,215,0,0.9);
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, rgba(255,215,0,0.1) 70%, transparent 100%);
            animation: discoveryPulse 2s ease-out;
            pointer-events: none;
            display: none;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        @keyframes discoveryPulse {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
            }
        }
        
        .completion-message {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .movement-guide {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 11px;
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
        <!-- Compact positioning for 100cm x 180cm space -->
        
        <!-- EAST: Right side, ground level, closer -->
        <a-gltf-model 
            id="east-artwork"
            src="" 
            scale="0 0 0" 
            position="1.5 -0.5 -1.8"
            animation__emerge="property: position; from: 1.5 -1.2 -1.8; to: 1.5 -0.1 -1.8; dur: 3000; easing: easeOutQuart; startEvents: emerge"
            animation__grow="property: scale; from: 0.1 0.1 0.1; to: 1.4 1.4 1.4; dur: 2500; easing: easeOutElastic; startEvents: grow"
            animation__float="property: position; from: 1.5 -0.1 -1.8; to: 1.5 0.1 -1.8; dir: alternate; dur: 4000; easing: easeInOutSine; loop: true; startEvents: float"
            animation__sway="property: rotation; to: 0 360 0; dur: 15000; loop: true; startEvents: sway"
            visible="false">
        </a-gltf-model>
        
        <!-- SOUTH: Front, ground level -->
        <a-gltf-model 
            id="south-artwork"
            src="" 
            scale="0 0 0" 
            position="0 -0.5 -1.2"
            animation__emerge="property: position; from: 0 -1.2 -1.2; to: 0 -0.1 -1.2; dur: 3000; easing: easeOutQuart; startEvents: emerge"
            animation__grow="property: scale; from: 0.1 0.1 0.1; to: 1.3 1.3 1.3; dur: 2500; easing: easeOutElastic; startEvents: grow"
            animation__float="property: position; from: 0 -0.1 -1.2; to: 0 0.1 -1.2; dir: alternate; dur: 5000; easing: easeInOutSine; loop: true; startEvents: float"
            animation__sway="property: rotation; to: 0 -360 0; dur: 18000; loop: true; startEvents: sway"
            visible="false">
        </a-gltf-model>
        
        <!-- WEST: Left side, ground level, closer -->
        <a-gltf-model 
            id="west-artwork"
            src="" 
            scale="0 0 0" 
            position="-1.5 -0.5 -1.8"
            animation__emerge="property: position; from: -1.5 -1.2 -1.8; to: -1.5 -0.1 -1.8; dur: 3000; easing: easeOutQuart; startEvents: emerge"
            animation__grow="property: scale; from: 0.1 0.1 0.1; to: 1.4 1.4 1.4; dur: 2500; easing: easeOutElastic; startEvents: grow"
            animation__float="property: position; from: -1.5 -0.1 -1.8; to: -1.5 0.1 -1.8; dir: alternate; dur: 4500; easing: easeInOutSine; loop: true; startEvents: float"
            animation__sway="property: rotation; to: 0 360 0; dur: 20000; loop: true; startEvents: sway"
            visible="false">
        </a-gltf-model>
        
        <!-- NORTH: Back center, ground level -->
        <a-gltf-model 
            id="north-artwork"
            src="" 
            scale="0 0 0" 
            position="0 -0.5 -2.5"
            animation__emerge="property: position; from: 0 -1.2 -2.5; to: 0 -0.1 -2.5; dur: 3000; easing: easeOutQuart; startEvents: emerge"
            animation__grow="property: scale; from: 0.1 0.1 0.1; to: 1.6 1.6 1.6; dur: 2500; easing: easeOutElastic; startEvents: grow"
            animation__float="property: position; from: 0 -0.1 -2.5; to: 0 0.1 -2.5; dir: alternate; dur: 6000; easing: easeInOutSine; loop: true; startEvents: float"
            animation__sway="property: rotation; to: 0 360 0; dur: 22000; loop: true; startEvents: sway"
            visible="false">
        </a-gltf-model>
        
        <a-entity camera look-controls wasd-controls="enabled: false"></a-entity>
    </a-scene>

    <div class="overlay">
        <div class="minimal-instructions" id="instructions">
            Take 2-3 steps and tap to discover sculptures ðŸŒ±
        </div>
        
        <div class="progress-counter" id="progress">
            <span id="count">0</span>/4
        </div>
        
        <div class="movement-guide" id="movementGuide">
            Move in small circle â€¢ Stay within 1 meter
        </div>
        
        <!-- Invisible discovery zones -->
        <div class="discovery-zone zone-east" id="zoneEast"></div>
        <div class="discovery-zone zone-west" id="zoneWest"></div>
        <div class="discovery-zone zone-north" id="zoneNorth"></div>
        <div class="discovery-zone zone-south" id="zoneSouth"></div>
        
        <div class="discovery-pulse" id="discoveryPulse"></div>
        
        <div class="completion-message" id="completionMessage">
            âœ¨ Garden Complete âœ¨<br>
            <small>Shake to explore again</small>
        </div>
    </div>

    <script>
        // Artwork configuration
        const artworkConfig = {
            'east-artwork': {
                src: 'east-piece.glb',
                name: 'Eastern Guardian',
                discovered: false
            },
            'south-artwork': {
                src: 'south-piece.glb',
                name: 'Southern Bloom',
                discovered: false
            },
            'west-artwork': {
                src: 'west-piece.glb',
                name: 'Western Spirit',
                discovered: false
            },
            'north-artwork': {
                src: 'north-piece.glb',
                name: 'Northern Crown',
                discovered: false
            }
        };

        let discoveredCount = 0;
        const loadingPromises = new Map();

        // Enhanced discovery function with clear animation sequence
        function discoverArtwork(artworkId) {
            if (artworkConfig[artworkId].discovered) return;
            
            const config = artworkConfig[artworkId];
            const model = document.getElementById(artworkId);
            
            // Show enhanced discovery pulse
            showDiscoveryPulse();
            
            // Mark as discovered
            artworkConfig[artworkId].discovered = true;
            discoveredCount++;
            updateProgress();
            
            // Load model silently
            if (!loadingPromises.has(artworkId)) {
                const loadPromise = loadModelSilently(model, config.src);
                loadingPromises.set(artworkId, loadPromise);
                
                loadPromise.then(() => {
                    showArtworkWithSequence(artworkId);
                }).catch(() => {
                    // Handle error silently
                    artworkConfig[artworkId].discovered = false;
                    discoveredCount--;
                    updateProgress();
                });
            }
        }

        function loadModelSilently(model, src) {
            return new Promise((resolve, reject) => {
                model.setAttribute('src', src);
                
                const onLoad = () => {
                    model.removeEventListener('model-loaded', onLoad);
                    model.removeEventListener('model-error', onError);
                    resolve();
                };
                
                const onError = () => {
                    model.removeEventListener('model-loaded', onLoad);
                    model.removeEventListener('model-error', onError);
                    reject();
                };
                
                model.addEventListener('model-loaded', onLoad);
                model.addEventListener('model-error', onError);
            });
        }

        function showArtworkWithSequence(artworkId) {
            const model = document.getElementById(artworkId);
            
            // Make visible with small initial scale
            model.setAttribute('visible', true);
            model.setAttribute('scale', '0.1 0.1 0.1');
            
            // Sequence: Emerge from ground (0.5s delay) â†’ Grow (immediate) â†’ Float (2s delay) â†’ Sway (3s delay)
            setTimeout(() => {
                model.emit('emerge');
            }, 500);
            
            setTimeout(() => {
                model.emit('grow');
            }, 800);
            
            setTimeout(() => {
                model.emit('float');
            }, 3500);
            
            setTimeout(() => {
                model.emit('sway');
            }, 4000);
        }

        function showDiscoveryPulse() {
            const pulse = document.getElementById('discoveryPulse');
            pulse.style.display = 'block';
            pulse.style.animation = 'none';
            
            // Trigger reflow to restart animation
            pulse.offsetHeight;
            pulse.style.animation = 'discoveryPulse 2s ease-out';
            
            setTimeout(() => {
                pulse.style.display = 'none';
            }, 2000);
        }

        function updateProgress() {
            document.getElementById('count').textContent = discoveredCount;
            
            if (discoveredCount >= 4) {
                // All discovered - show completion
                setTimeout(() => {
                    document.getElementById('instructions').style.display = 'none';
                    document.getElementById('movementGuide').style.display = 'none';
                    document.getElementById('completionMessage').style.display = 'block';
                }, 3000);
            } else {
                // Update instructions based on progress
                updateInstructions();
            }
        }

        function updateInstructions() {
            const instructions = document.getElementById('instructions');
            const movementGuide = document.getElementById('movementGuide');
            
            const messages = [
                "Take 2-3 steps and tap to discover sculptures ðŸŒ±",
                "Keep exploring in small circle... more await ðŸŒ¿",
                "Almost complete... one more direction ðŸŒ¸",
                "Find the final piece to finish your garden ðŸŒº"
            ];
            
            const guides = [
                "Move in small circle â€¢ Stay within 1 meter",
                "Step to different sides â€¢ Tap when ready",
                "One more direction to explore",
                "Final sculpture awaits discovery"
            ];
            
            if (discoveredCount < messages.length) {
                instructions.innerHTML = messages[discoveredCount];
                movementGuide.innerHTML = guides[discoveredCount];
            }
        }

        // Discovery zone handlers
        document.getElementById('zoneEast').addEventListener('click', () => discoverArtwork('east-artwork'));
        document.getElementById('zoneWest').addEventListener('click', () => discoverArtwork('west-artwork'));
        document.getElementById('zoneNorth').addEventListener('click', () => discoverArtwork('north-artwork'));
        document.getElementById('zoneSouth').addEventListener('click', () => discoverArtwork('south-artwork'));

        // Zoom functionality (pinch)
        let lastTouchDistance = 0;
        let isZooming = false;

        document.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                isZooming = true;
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                lastTouchDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
            }
        });

        document.addEventListener('touchmove', function(e) {
            if (e.touches.length === 2 && isZooming) {
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
                
                const scale = currentDistance / lastTouchDistance;
                zoomVisibleModels(scale);
                lastTouchDistance = currentDistance;
                e.preventDefault();
            }
        });

        document.addEventListener('touchend', function(e) {
            if (e.touches.length < 2) {
                isZooming = false;
            }
        });

        function zoomVisibleModels(scaleFactor) {
            Object.keys(artworkConfig).forEach(artworkId => {
                if (artworkConfig[artworkId].discovered) {
                    const model = document.getElementById(artworkId);
                    if (model.getAttribute('visible')) {
                        const currentScale = model.getAttribute('scale');
                        const newScale = {
                            x: Math.max(0.5, Math.min(2.5, currentScale.x * scaleFactor)),
                            y: Math.max(0.5, Math.min(2.5, currentScale.y * scaleFactor)),
                            z: Math.max(0.5, Math.min(2.5, currentScale.z * scaleFactor))
                        };
                        model.setAttribute('scale', newScale);
                    }
                }
            });
        }

        // Reset garden function
        function resetGarden() {
            Object.keys(artworkConfig).forEach(artworkId => {
                const model = document.getElementById(artworkId);
                model.setAttribute('visible', false);
                model.setAttribute('scale', '0 0 0');
                model.setAttribute('src', '');
                artworkConfig[artworkId].discovered = false;
            });
            
            discoveredCount = 0;
            loadingPromises.clear();
            
            document.getElementById('count').textContent = '0';
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('movementGuide').style.display = 'block';
            document.getElementById('instructions').innerHTML = 'Take 2-3 steps and tap to discover sculptures ðŸŒ±';
            document.getElementById('movementGuide').innerHTML = 'Move in small circle â€¢ Stay within 1 meter';
            document.getElementById('completionMessage').style.display = 'none';
        }

        // Shake to reset
        let shakeTimeout;
        window.addEventListener('devicemotion', function(event) {
            if (event.acceleration && 
                (Math.abs(event.acceleration.x) > 15 || 
                 Math.abs(event.acceleration.y) > 15 || 
                 Math.abs(event.acceleration.z) > 15)) {
                
                clearTimeout(shakeTimeout);
                shakeTimeout = setTimeout(resetGarden, 500);
            }
        });

        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Hide movement guide after 10 seconds
        setTimeout(() => {
            const guide = document.getElementById('movementGuide');
            if (guide && discoveredCount === 0) {
                guide.style.opacity = '0.5';
                setTimeout(() => {
                    guide.style.display = 'none';
                }, 2000);
            }
        }, 10000);
    </script>
</body>
</html>
