<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Gelora - Embodied Resurrection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: Arial; 
            overflow: hidden; 
            background: #0a0a0a;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
        
        .movement-instructions {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: rgba(255,255,255,0.9);
            padding: 12px 20px;
            border-radius: 20px;
            text-align: center;
            font-size: 12px;
            max-width: 70%;
            backdrop-filter: blur(5px);
            font-weight: 300;
        }
        
        .body-guide {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 10px;
            backdrop-filter: blur(3px);
            font-weight: 300;
            text-align: center;
        }
        
        .movement-counter {
            position: absolute;
            top: 120px;
            right: 25px;
            background: rgba(0,0,0,0.5);
            color: rgba(255,255,255,0.8);
            padding: 8px 12px;
            border-radius: 12px;
            font-weight: 300;
            font-size: 10px;
            backdrop-filter: blur(3px);
        }
        
        /* Movement detection zones */
        .movement-zone {
            position: absolute;
            pointer-events: all;
            background: rgba(255,255,255,0.05);
            border: 1px dashed rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.7);
            font-size: 10px;
            font-weight: 300;
            text-align: center;
            transition: all 0.3s;
        }
        
        .movement-zone:active {
            background: rgba(255,255,255,0.2);
        }
        
        .zone-east {
            right: 5%;
            top: 30%;
            width: 20%;
            height: 40%;
            border-left: none;
        }
        
        .zone-west {
            left: 5%;
            top: 30%;
            width: 20%;
            height: 40%;
            border-right: none;
        }
        
        .zone-north {
            top: 10%;
            left: 30%;
            width: 40%;
            height: 20%;
            border-bottom: none;
        }
        
        .zone-south {
            bottom: 10%;
            left: 30%;
            width: 40%;
            height: 20%;
            border-top: none;
        }
        
        /* Swirling resurrection pulses */
        .resurrection-pulse {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            pointer-events: none;
            display: none;
            transform: translate(-50%, -50%);
        }
        
        .pulse-east {
            border: 4px solid rgba(0,255,127,0.9);
            background: radial-gradient(circle, rgba(0,255,127,0.4) 0%, rgba(0,255,127,0.1) 60%, transparent 100%);
            box-shadow: 0 0 40px rgba(0,255,127,0.8), inset 0 0 25px rgba(0,255,127,0.3);
            animation: swirlingGreen 4s ease-out;
        }
        
        .pulse-south {
            border: 4px solid rgba(255,20,147,0.9);
            background: radial-gradient(circle, rgba(255,20,147,0.4) 0%, rgba(255,20,147,0.1) 60%, transparent 100%);
            box-shadow: 0 0 40px rgba(255,20,147,0.8), inset 0 0 25px rgba(255,20,147,0.3);
            animation: swirlingPink 4s ease-out;
        }
        
        .pulse-west {
            border: 4px solid rgba(255,255,255,0.9);
            background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 60%, transparent 100%);
            box-shadow: 0 0 40px rgba(255,255,255,0.8), inset 0 0 25px rgba(255,255,255,0.3);
            animation: swirlingWhite 4s ease-out;
        }
        
        .pulse-north {
            border: 4px solid rgba(173,216,230,0.9);
            background: radial-gradient(circle, rgba(173,216,230,0.4) 0%, rgba(173,216,230,0.1) 60%, transparent 100%);
            box-shadow: 0 0 40px rgba(173,216,230,0.8), inset 0 0 25px rgba(173,216,230,0.3);
            animation: swirlingBlue 4s ease-out;
        }
        
        @keyframes swirlingGreen {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg); 
                opacity: 1; 
            }
            30% { 
                transform: translate(-50%, -50%) scale(0.8) rotate(180deg); 
                opacity: 0.9; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(3) rotate(720deg); 
                opacity: 0; 
            }
        }
        
        @keyframes swirlingPink {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg); 
                opacity: 1; 
            }
            30% { 
                transform: translate(-50%, -50%) scale(0.8) rotate(-180deg); 
                opacity: 0.9; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(3) rotate(-720deg); 
                opacity: 0; 
            }
        }
        
        @keyframes swirlingWhite {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg); 
                opacity: 1; 
            }
            30% { 
                transform: translate(-50%, -50%) scale(0.8) rotate(180deg); 
                opacity: 0.9; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(3) rotate(720deg); 
                opacity: 0; 
            }
        }
        
        @keyframes swirlingBlue {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg); 
                opacity: 1; 
            }
            30% { 
                transform: translate(-50%, -50%) scale(0.8) rotate(-180deg); 
                opacity: 0.9; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(3) rotate(-720deg); 
                opacity: 0; 
            }
        }
        
        .ritual-complete {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: rgba(255,255,255,0.9);
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 12px;
            display: none;
            text-align: center;
            backdrop-filter: blur(5px);
            font-weight: 300;
        }
    </style>
</head>
<body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
        <!-- Container for resurrection memories with wide spacing -->
        <a-entity id="memorial-container"></a-entity>
        
        <a-entity camera look-controls="enabled: true; pointerLockEnabled: false" wasd-controls="enabled: false"></a-entity>
    </a-scene>

    <div class="overlay">
        <div class="movement-instructions" id="instructions">
            Move your body and touch to resurrect memories
        </div>
        
        <div class="body-guide" id="bodyGuide">
            Walk to each direction then gesture
        </div>
        
        <div class="movement-counter" id="progress">
            Embodied rituals: <span id="count">0</span>/4
        </div>
        
        <!-- Movement zones that encourage body positioning -->
        <div class="movement-zone zone-east" id="zoneEast">
            Move right<br>then touch
        </div>
        
        <div class="movement-zone zone-west" id="zoneWest">
            Move left<br>then touch
        </div>
        
        <div class="movement-zone zone-north" id="zoneNorth">
            Step forward then touch
        </div>
        
        <div class="movement-zone zone-south" id="zoneSouth">
            Step closer then touch
        </div>
        
        <!-- Swirling resurrection pulses -->
        <div class="resurrection-pulse pulse-east" id="pulseEast"></div>
        <div class="resurrection-pulse pulse-south" id="pulseSouth"></div>
        <div class="resurrection-pulse pulse-west" id="pulseWest"></div>
        <div class="resurrection-pulse pulse-north" id="pulseNorth"></div>
        
        <div class="ritual-complete" id="ritualComplete">
            Memorial circle embodied<br>
            <small>Walk around to explore • Shake to begin anew</small>
        </div>
    </div>

    <script>
        // Embodied resurrection configuration
        const embodiedSequence = [
            {
                id: 'east-memory',
                src: 'east-piece.glb',
                name: 'Eastern Memory',
                pulseId: 'pulseEast',
                direction: 'east'
            },
            {
                id: 'south-memory',
                src: 'south-piece.glb',
                name: 'Southern Memory',
                pulseId: 'pulseSouth',
                direction: 'south'
            },
            {
                id: 'west-memory',
                src: 'west-piece.glb',
                name: 'Western Memory',
                pulseId: 'pulseWest',
                direction: 'west'
            },
            {
                id: 'north-memory',
                src: 'north-piece.glb',
                name: 'Northern Memory',
                pulseId: 'pulseNorth',
                direction: 'north'
            }
        ];

        let currentRitualIndex = 0;
        let embodiedCount = 0;
        const embodiedMemories = new Set();
        
        // Wide spaced positions for 360° exploration
        const memorialPositions = [
            { x: 2.5, y: -0.5, z: -2.5 },   // East - far right
            { x: 0.0, y: -0.5, z: -0.8 },   // South - close front
            { x: -2.5, y: -0.5, z: -2.5 },  // West - far left
            { x: 0.0, y: -0.5, z: -4.0 }    // North - far back
        ];

        // Embodied gesture handlers
        document.getElementById('zoneEast').addEventListener('click', () => performEmbodiedRitual('east'));
        document.getElementById('zoneWest').addEventListener('click', () => performEmbodiedRitual('west'));
        document.getElementById('zoneNorth').addEventListener('click', () => performEmbodiedRitual('north'));
        document.getElementById('zoneSouth').addEventListener('click', () => performEmbodiedRitual('south'));

        function performEmbodiedRitual(direction) {
            if (currentRitualIndex >= embodiedSequence.length) return;
            
            const currentRitual = embodiedSequence[currentRitualIndex];
            
            // Find position for this direction
            const positionIndex = embodiedSequence.findIndex(ritual => ritual.direction === direction);
            if (positionIndex === -1) return;
            
            const memorialPosition = memorialPositions[positionIndex];
            
            // Show swirling resurrection pulse
            showSwirlingPulse(currentRitual.pulseId, direction);
            
            // Begin embodied resurrection
            resurrectWithMovement(currentRitual, memorialPosition);
            
            currentRitualIndex++;
            embodiedCount++;
            updateEmbodiedProgress();
        }

        function showSwirlingPulse(pulseId, direction) {
            const pulse = document.getElementById(pulseId);
            
            // Position pulse based on movement zone
            const positions = {
                'east': { x: '85%', y: '50%' },
                'west': { x: '15%', y: '50%' },
                'north': { x: '50%', y: '20%' },
                'south': { x: '50%', y: '80%' }
            };
            
            const pos = positions[direction];
            pulse.style.left = pos.x;
            pulse.style.top = pos.y;
            pulse.style.display = 'block';
            pulse.style.animation = 'none';
            
            // Restart swirling animation
            pulse.offsetHeight;
            const animationName = pulse.className.includes('pulse-east') ? 'swirlingGreen 4s ease-out' :
                                pulse.className.includes('pulse-south') ? 'swirlingPink 4s ease-out' :
                                pulse.className.includes('pulse-west') ? 'swirlingWhite 4s ease-out' :
                                'swirlingBlue 4s ease-out';
            pulse.style.animation = animationName;
            
            setTimeout(() => {
                pulse.style.display = 'none';
            }, 4000);
        }

        function resurrectWithMovement(ritualConfig, position) {
            const container = document.getElementById('memorial-container');
            
            // Create memory sculpture element
            const memory = document.createElement('a-gltf-model');
            memory.setAttribute('id', ritualConfig.id);
            memory.setAttribute('src', ritualConfig.src);
            memory.setAttribute('position', `${position.x} ${position.y - 0.6} ${position.z}`);
            memory.setAttribute('scale', '0 0 0');
            memory.setAttribute('visible', false);
            
            // Faster emergence with swirling resurrection
            memory.setAttribute('animation__emerge', 
                'property: position; ' +
                `from: ${position.x} ${position.y - 1.0} ${position.z}; ` +
                `to: ${position.x} ${position.y + 0.1} ${position.z}; ` +
                'dur: 25000; easing: easeOutQuart; startEvents: emerge'
            );
            
            // Swirling growth animation
            memory.setAttribute('animation__swirl-resurrect', 
                'property: scale; from: 0 0 0; to: 0.9 0.9 0.9; ' +
                'dur: 30000; easing: easeOutElastic; startEvents: resurrect'
            );
            
            memory.setAttribute('animation__swirl-emerge', 
                'property: rotation; from: 0 0 0; to: 0 720 0; ' +
                'dur: 25000; easing: easeOutQuart; startEvents: swirl'
            );
            
            // Living breathing motions for 360° exploration
            memory.setAttribute('animation__life-breathe', 
                `property: position; from: ${position.x} ${position.y + 0.1} ${position.z}; ` +
                `to: ${position.x} ${position.y + 0.25} ${position.z}; ` +
                'dir: alternate; dur: 15000; easing: easeInOutSine; loop: true; startEvents: breathe'
            );
            
            // Continuous gentle rotation for 360° viewing
            memory.setAttribute('animation__life-turn', 
                'property: rotation; from: 0 720 0; to: 0 1080 0; ' +
                'dur: 120000; easing: linear; loop: true; startEvents: turn'
            );
            
            // Scale breathing for life essence
            memory.setAttribute('animation__life-essence', 
                'property: scale; from: 0.9 0.9 0.9; to: 0.94 0.94 0.94; ' +
                'dir: alternate; dur: 18000; easing: easeInOutSine; loop: true; startEvents: essence'
            );
            
            container.appendChild(memory);
            
            // Load and show with embodied timing
            memory.addEventListener('model-loaded', function() {
                setTimeout(() => {
                    memory.setAttribute('visible', true);
                    memory.emit('emerge');
                    memory.emit('swirl');
                }, 800);
                
                setTimeout(() => {
                    memory.emit('resurrect');
                }, 1500);
                
                setTimeout(() => {
                    memory.emit('breathe');
                    memory.emit('turn');
                    memory.emit('essence');
                }, 20000); // Start life motions after swirling resurrection
            });
            
            memory.addEventListener('model-error', function() {
                console.log(`Failed to resurrect ${ritualConfig.name}`);
            });
            
            embodiedMemories.add(ritualConfig.id);
        }

        function updateEmbodiedProgress() {
            document.getElementById('count').textContent = embodiedCount;
            
            if (embodiedCount >= 4) {
                // Embodied ritual complete
                setTimeout(() => {
                    document.getElementById('instructions').style.display = 'none';
                    document.getElementById('bodyGuide').style.display = 'none';
                    document.querySelectorAll('.movement-zone').forEach(zone => {
                        zone.style.display = 'none';
                    });
                    document.getElementById('ritualComplete').style.display = 'block';
                }, 3000);
            } else {
                updateEmbodiedInstructions();
            }
        }

        function updateEmbodiedInstructions() {
            const instructions = document.getElementById('instructions');
            const bodyGuide = document.getElementById('bodyGuide');
            const messages = [
                "Move your body and touch to resurrect memories",
                "Continue the embodied ritual",
                "Two more movements await",
                "Final embodied gesture"
            ];
            
            const guides = [
                "Walk to each direction then gesture",
                "Body movement awakens memories",
                "Physical presence needed for revival",
                "Complete the ritual circle"
            ];
            
            if (embodiedCount < messages.length) {
                instructions.innerHTML = messages[embodiedCount];
                bodyGuide.innerHTML = guides[embodiedCount];
            }
        }

        // Enhanced zoom for 360° exploration
        let lastTouchDistance = 0;
        let isZooming = false;

        document.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                isZooming = true;
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                lastTouchDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
                e.preventDefault();
            }
        });

        document.addEventListener('touchmove', function(e) {
            if (e.touches.length === 2 && isZooming) {
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
                
                const scale = currentDistance / lastTouchDistance;
                exploreMemories(scale);
                lastTouchDistance = currentDistance;
                e.preventDefault();
            }
        });

        document.addEventListener('touchend', function(e) {
            if (e.touches.length < 2) {
                isZooming = false;
            }
        });

        function exploreMemories(scaleFactor) {
            embodiedMemories.forEach(memoryId => {
                const memory = document.getElementById(memoryId);
                if (memory && memory.getAttribute('visible')) {
                    const currentScale = memory.getAttribute('scale');
                    const newScale = {
                        x: Math.max(0.4, Math.min(1.5, currentScale.x * scaleFactor)),
                        y: Math.max(0.4, Math.min(1.5, currentScale.y * scaleFactor)),
                        z: Math.max(0.4, Math.min(1.5, currentScale.z * scaleFactor))
                    };
                    memory.setAttribute('scale', newScale);
                }
            });
        }

        // Reset embodied ritual space
        function resetEmbodiedRitual() {
            const container = document.getElementById('memorial-container');
            container.innerHTML = '';
            
            currentRitualIndex = 0;
            embodiedCount = 0;
            embodiedMemories.clear();
            
            document.getElementById('count').textContent = '0';
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('bodyGuide').style.display = 'block';
            document.getElementById('instructions').innerHTML = 'Move your body and touch to resurrect memories';
            document.getElementById('bodyGuide').innerHTML = 'Walk to each direction then gesture';
            document.getElementById('ritualComplete').style.display = 'none';
            
            // Show movement zones again
            document.querySelectorAll('.movement-zone').forEach(zone => {
                zone.style.display = 'flex';
            });
        }

        // Gentle shake to reset
        let shakeTimeout;
        window.addEventListener('devicemotion', function(event) {
            if (event.acceleration && 
                (Math.abs(event.acceleration.x) > 12 || 
                 Math.abs(event.acceleration.y) > 12 || 
                 Math.abs(event.acceleration.z) > 12)) {
                
                clearTimeout(shakeTimeout);
                shakeTimeout = setTimeout(resetEmbodiedRitual, 1000);
            }
        });

        // Prevent context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
