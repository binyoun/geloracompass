<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Art Exhibition - Enhanced</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; font-family: Arial; overflow: hidden; }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
        .instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            max-width: 80%;
        }
        
        /* Directional Tap Zones */
        .tap-zone {
            position: absolute;
            pointer-events: all;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .tap-zone:active {
            background: rgba(255,255,255,0.3);
        }
        
        /* East - Right side */
        .tap-east {
            right: 0;
            top: 25%;
            width: 25%;
            height: 50%;
            border-left: none;
        }
        
        /* West - Left side */
        .tap-west {
            left: 0;
            top: 25%;
            width: 25%;
            height: 50%;
            border-right: none;
        }
        
        /* North - Top */
        .tap-north {
            top: 0;
            left: 25%;
            width: 50%;
            height: 25%;
            border-bottom: none;
        }
        
        /* South - Bottom */
        .tap-south {
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 25%;
            border-top: none;
        }
        
        .progress-info {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 16px;
            display: none;
            text-align: center;
        }
        
        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .camera-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            display: none;
            pointer-events: all;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .camera-button:active {
            background: rgba(255,255,255,0.7);
        }
        
        .zoom-info {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 12px;
            display: none;
        }
        
        .artwork-info {
            position: absolute;
            top: 120px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 12px;
            max-width: 200px;
            display: none;
        }
    </style>
</head>
<body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
        <!-- Human-sized models with better positioning -->
        
        <!-- EAST: Right side, human scale -->
        <a-gltf-model 
            id="east-artwork"
            src="" 
            scale="0 0 0" 
            position="3 0 -3"
            animation__appear="property: scale; from: 0 0 0; to: 1.8 1.8 1.8; dur: 2000; easing: easeOutElastic"
            animation__float="property: position; from: 3 -0.5 -3; to: 3 0 -3; dur: 3000; easing: easeOutQuad"
            animation__rotate="property: rotation; to: 0 360 0; loop: true; dur: 12000"
            visible="false">
        </a-gltf-model>
        
        <!-- SOUTH: Closer to viewer, slightly right -->
        <a-gltf-model 
            id="south-artwork"
            src="" 
            scale="0 0 0" 
            position="1 0 -1.5"
            animation__appear="property: scale; from: 0 0 0; to: 1.6 1.6 1.6; dur: 2000; easing: easeOutElastic"
            animation__float="property: position; from: 1 -0.5 -1.5; to: 1 0 -1.5; dur: 3000; easing: easeOutQuad"
            animation__rotate="property: rotation; to: 0 360 0; loop: true; dur: 15000"
            visible="false">
        </a-gltf-model>
        
        <!-- WEST: Left side, human scale -->
        <a-gltf-model 
            id="west-artwork"
            src="" 
            scale="0 0 0" 
            position="-3 0 -3"
            animation__appear="property: scale; from: 0 0 0; to: 1.8 1.8 1.8; dur: 2000; easing: easeOutElastic"
            animation__float="property: position; from: -3 -0.5 -3; to: -3 0 -3; dur: 3000; easing: easeOutQuad"
            animation__rotate="property: rotation; to: 0 -360 0; loop: true; dur: 14000"
            visible="false">
        </a-gltf-model>
        
        <!-- NORTH: Far back, slightly left to avoid overlap -->
        <a-gltf-model 
            id="north-artwork"
            src="" 
            scale="0 0 0" 
            position="-1 0 -5"
            animation__appear="property: scale; from: 0 0 0; to: 2.0 2.0 2.0; dur: 2000; easing: easeOutElastic"
            animation__float="property: position; from: -1 -0.5 -5; to: -1 0 -5; dur: 3000; easing: easeOutQuad"
            animation__rotate="property: rotation; to: 0 360 0; loop: true; dur: 10000"
            visible="false">
        </a-gltf-model>
        
        <a-entity camera look-controls wasd-controls="enabled: false" cursor="rayOrigin: mouse"></a-entity>
    </a-scene>

    <div class="overlay">
        <div class="instructions" id="instructions">
            Tap different areas of the screen to grow your compass garden! üß≠üå∏
        </div>
        
        <div class="progress-info" id="progress">
            Garden: <span id="count">0</span>/4
        </div>
        
        <div class="artwork-info" id="artworkInfo"></div>
        
        <div class="loading-indicator" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <div id="loadingText">Loading artwork...</div>
        </div>
        
        <div class="zoom-info" id="zoomInfo">
            Pinch to zoom ‚Ä¢ Double tap to focus
        </div>
        
        <!-- Directional Tap Zones -->
        <div class="tap-zone tap-east" id="tapEast">
            TAP<br>EAST<br>‚û°Ô∏è
        </div>
        
        <div class="tap-zone tap-west" id="tapWest">
            TAP<br>WEST<br>‚¨ÖÔ∏è
        </div>
        
        <div class="tap-zone tap-north" id="tapNorth">
            TAP NORTH ‚¨ÜÔ∏è
        </div>
        
        <div class="tap-zone tap-south" id="tapSouth">
            TAP SOUTH ‚¨áÔ∏è
        </div>
        
        <button class="camera-button" id="cameraButton" title="Take Photo">üì∑</button>
    </div>

    <script>
        // Configuration with your file sizes
        const artworkConfig = {
            'east-artwork': {
                src: 'east-piece.glb',
                name: 'East Sculpture',
                direction: 'EAST ‚û°Ô∏è',
                size: '9.5MB',
                loaded: false
            },
            'south-artwork': {
                src: 'south-piece.glb',
                name: 'South Sculpture',
                direction: 'SOUTH ‚¨áÔ∏è',
                size: '7.7MB',
                loaded: false
            },
            'west-artwork': {
                src: 'west-piece.glb',
                name: 'West Sculpture',
                direction: 'WEST ‚¨ÖÔ∏è',
                size: '7.6MB',
                loaded: false
            },
            'north-artwork': {
                src: 'north-piece.glb',
                name: 'North Sculpture',
                direction: 'NORTH ‚¨ÜÔ∏è',
                size: '9.4MB',
                loaded: false
            }
        };

        let artworksVisible = 0;
        let isLoading = false;
        let currentZoomedModel = null;

        // Load artwork function
        function loadArtwork(artworkId) {
            if (isLoading || artworkConfig[artworkId].loaded) {
                if (artworkConfig[artworkId].loaded) {
                    // Already loaded, just show it
                    showArtwork(artworkId);
                }
                return;
            }

            const config = artworkConfig[artworkId];
            const model = document.getElementById(artworkId);
            
            // Show loading
            isLoading = true;
            showLoading(config.name, config.size);
            
            // Load the model
            model.setAttribute('src', config.src);
            
            // Handle successful load
            model.addEventListener('model-loaded', function() {
                isLoading = false;
                artworkConfig[artworkId].loaded = true;
                hideLoading();
                showArtwork(artworkId);
                updateProgress();
            });
            
            // Handle load error
            model.addEventListener('model-error', function() {
                isLoading = false;
                hideLoading();
                showError(config.name);
            });
        }

        function showArtwork(artworkId) {
            const model = document.getElementById(artworkId);
            const config = artworkConfig[artworkId];
            
            model.setAttribute('visible', true);
            model.emit('appear');
            model.emit('float');
            model.emit('rotate');
            
            artworksVisible++;
            updateProgress();
            
            // Show artwork info
            showArtworkInfo(config);
            
            // Show zoom info
            setTimeout(() => {
                document.getElementById('zoomInfo').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('zoomInfo').style.display = 'none';
                }, 3000);
            }, 1000);
        }

        function showArtworkInfo(config) {
            const infoEl = document.getElementById('artworkInfo');
            infoEl.innerHTML = `<strong>${config.name}</strong><br>Direction: ${config.direction}<br>Size: ${config.size}`;
            infoEl.style.display = 'block';
            setTimeout(() => {
                infoEl.style.display = 'none';
            }, 4000);
        }

        function updateProgress() {
            document.getElementById('count').textContent = artworksVisible;
            
            if (artworksVisible >= 4) {
                // All artworks visible - show camera button
                document.getElementById('cameraButton').style.display = 'block';
                document.getElementById('instructions').innerHTML = 
                    'üéâ Complete Compass Garden! üß≠<br><small>Use camera button to take photos ‚Ä¢ Shake to reset</small>';
                
                // Hide tap zones
                document.querySelectorAll('.tap-zone').forEach(zone => {
                    zone.style.display = 'none';
                });
            }
        }

        function showLoading(name, size) {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('loadingText').textContent = `Loading ${name}... (${size})`;
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }

        function showError(name) {
            document.getElementById('instructions').innerHTML = 
                `‚ùå Failed to load ${name}<br><small>Check connection and try again</small>`;
        }

        // Directional tap handlers
        document.getElementById('tapEast').addEventListener('click', () => loadArtwork('east-artwork'));
        document.getElementById('tapWest').addEventListener('click', () => loadArtwork('west-artwork'));
        document.getElementById('tapNorth').addEventListener('click', () => loadArtwork('north-artwork'));
        document.getElementById('tapSouth').addEventListener('click', () => loadArtwork('south-artwork'));

        // Camera functionality
        document.getElementById('cameraButton').addEventListener('click', function() {
            // Take screenshot of the AR scene
            const canvas = document.querySelector('a-scene').components.screenshot.getCanvas('perspective');
            const link = document.createElement('a');
            link.download = `ar-garden-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            // Show feedback
            this.innerHTML = '‚úì';
            setTimeout(() => {
                this.innerHTML = 'üì∑';
            }, 1000);
        });

        // Zoom functionality - pinch and double tap
        let lastTouchDistance = 0;
        let doubleTapTimeout = null;

        document.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                // Pinch start
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                lastTouchDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
            } else if (e.touches.length === 1) {
                // Check for double tap
                if (doubleTapTimeout) {
                    clearTimeout(doubleTapTimeout);
                    doubleTapTimeout = null;
                    handleDoubleTap(e.touches[0]);
                } else {
                    doubleTapTimeout = setTimeout(() => {
                        doubleTapTimeout = null;
                    }, 300);
                }
            }
        });

        document.addEventListener('touchmove', function(e) {
            if (e.touches.length === 2) {
                // Pinch zoom
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
                
                const scale = currentDistance / lastTouchDistance;
                zoomAllVisibleModels(scale);
                lastTouchDistance = currentDistance;
                e.preventDefault();
            }
        });

        function handleDoubleTap(touch) {
            // Reset zoom for all models
            resetAllModelZoom();
        }

        function zoomAllVisibleModels(scaleFactor) {
            Object.keys(artworkConfig).forEach(artworkId => {
                if (artworkConfig[artworkId].loaded) {
                    const model = document.getElementById(artworkId);
                    if (model.getAttribute('visible')) {
                        const currentScale = model.getAttribute('scale');
                        const newScale = {
                            x: Math.max(0.5, Math.min(3.0, currentScale.x * scaleFactor)),
                            y: Math.max(0.5, Math.min(3.0, currentScale.y * scaleFactor)),
                            z: Math.max(0.5, Math.min(3.0, currentScale.z * scaleFactor))
                        };
                        model.setAttribute('scale', newScale);
                    }
                }
            });
        }

        function resetAllModelZoom() {
            const defaultScales = {
                'east-artwork': '1.8 1.8 1.8',
                'south-artwork': '1.6 1.6 1.6', 
                'west-artwork': '1.8 1.8 1.8',
                'north-artwork': '2.0 2.0 2.0'
            };
            
            Object.keys(defaultScales).forEach(artworkId => {
                if (artworkConfig[artworkId].loaded) {
                    const model = document.getElementById(artworkId);
                    model.setAttribute('scale', defaultScales[artworkId]);
                }
            });
        }

        // Reset function
        function resetGarden() {
            Object.keys(artworkConfig).forEach(artworkId => {
                const model = document.getElementById(artworkId);
                model.setAttribute('visible', false);
                model.setAttribute('scale', '0 0 0');
                model.setAttribute('src', '');
                artworkConfig[artworkId].loaded = false;
            });
            
            artworksVisible = 0;
            document.getElementById('count').textContent = '0';
            document.getElementById('cameraButton').style.display = 'none';
            document.getElementById('instructions').innerHTML = 
                'Tap different areas of the screen to grow your compass garden! üß≠üå∏';
            
            // Show tap zones again
            document.querySelectorAll('.tap-zone').forEach(zone => {
                zone.style.display = 'flex';
            });
        }

        // Shake to reset
        let shakeTimeout;
        window.addEventListener('devicemotion', function(event) {
            if (event.acceleration && 
                (Math.abs(event.acceleration.x) > 15 || 
                 Math.abs(event.acceleration.y) > 15 || 
                 Math.abs(event.acceleration.z) > 15)) {
                
                clearTimeout(shakeTimeout);
                shakeTimeout = setTimeout(resetGarden, 500);
            }
        });
    </script>
</body>
</html>
